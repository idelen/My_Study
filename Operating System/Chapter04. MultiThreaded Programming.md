<h1> Chapter04. MultiThreaded Programming</h1>

<h2> Threads</h2>

---

- 싱글 스레드(Single Thread) : 프로세스가 한 번에 하나의 작업만 수행하는 것

- 멀티 스레드(Multi Thread) : 프로세스가 동시에 여러 작업을 수행하는 것

- **스레드를 사용하는 이유**

  ```markdown
  1. 두 프로세스가 하나의 데이터를 공유하려면 메시지 패싱이나 공유 메모리 또는 파이프를 사용해야 하는데, 효율도 떨어지고 개발자가 구현, 관리하기도 번거롭다.
  2. 프로세스 사이 컨텍스트 스위치가 계속 일어나면 성능 저하가 발생한다. 스레드 전환에도 컨텍스트 스위치가 일어나지만 속도가 더 빠르다.
  ```



<h2> Multithreaded Server Architecture</h2>

---

- 서버와 클라이언트 사이에도 멀티스레드를 구현
- 클라이언트가 서버에게 요청을 보내면 서버는 새로운 스레드를 하나 생성
- 프로세스보다 스레드를 생성하는 것이 더 빠르기 때문



<h2>Multicore Programming</h2>

---

- **동시성(Concurrency)**

  : 프로세서가 여러 개의 스레드를 번갈아가며 수행함으로써 **동시에 실행되는 것처럼 보이게 하는 방식**

  -> 싱글 프로세서 시스템에서 사용되는 방식

- **병렬성(Parallelism)**

  : 여러 개의 코어가 **각 스레드를 동시에 수행하는 방식**

  -> 멀티 프로세서 시스템에서 사용되는 방식



<h2> User Threads and Kernel Threads</h2>

---

- **유저 스레드**

  : 사용자 수준의 스레드 라이브러리가 관리하는 스레드 

  -> 유저 스레드를 사용하면 안정성은 떨어지지만 성능이 저하되지는 않는다.

- **커널 스레드**

  : 커널이 지원하는 스레드

  -> 커널 스레드를 사용하면 안정적이지만 유저 모드에서 커널 모드로 계속 바꿔줘야 하기에 성능이 저하된다.

- 스레드 라이브러리의 예시

  ex) POSIX, Pthreads, Win32 threads, Java threads 등등



<h2> Multithreading Models</h2>

---

<h3> 1. Many-to-One Model</h3>

: 하나의 커널 스레드에 여러 개의 유저 스레드를 연결하는 모델

- 한 번에 하나의 유저 스레드만 커널에 접근할 수 있기에 멀티코어 시스템에서 병렬적인 수행이 불가 / 요즘엔 잘 사용하지 않음

<h3> 2. One-to-One Model</h3>

: 하나의 유저 스레드에 하나의 커널 스레드가 대응하는 모델

- 동시성을 높여주고, `멀티프로세서 시스템`에서는 동시에 여러 스레드를 수행할 수 있도록 해준다.
- 단, 유저 스레드를 늘리면 커널 스레드도 똑같이 늘어나는데, 커널 스레드를 생성하는 것은 오버헤드가 큰 작업이기 떄문에 성능 저하가 발생할 수 있다.

<h3> 3. Many-to-Many Model</h3>

: 여러 유저 스레드에 더 적거나 같은 수의 커널 스레드가 대응하는 모델

- 운영체제는 충분한 수의 커널 스레드를 만들 수 있따.
- `멀티프로세서 시스템`에서는 싱글프로세서 시스템보다 더 많은 커널 스레드가 만들어진다.

<h3>4. Two-Level Model</h3>

: Many-to-Many Model 과 유사하며, **특정 유저 스레드를 위한 커널 스레드를 따로 제공하는 모델

- 점유율이 높아야 하는 유저 스레드를 더 빠르게 처리할 수 있다.



<h2>Thread Pools</h2>

---

- **미리 스레드 풀에 여러 개의 스레드를 만들어두고** 요청이 오면 스레드 풀에서 스레드를 할당해주는 방법

  -> 스레드를 요청할 떄마다 매번 새로운 스레드를 생성, 수행, 지우고를 반복하면 성능이 저하되기 때문











